<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chá de Casa Nova</title>

  <style>
    :root {
      --cinza: #6b696a;
      --verde-claro: #a3b899;
      --fundo: #f5f5f5;
      --branco: #ffffff;
      --bege:  #e8e0d0;
      --madeira:#c8a887;
    }
    body{font-family:"Helvetica Neue",Arial,sans-serif;background:var(--fundo);color:var(--cinza);margin:0;line-height:1.6;}
    .container{max-width:1000px;margin:0 auto;padding:2rem;}
    header{text-align:center;margin-bottom:3rem;}
    h1{font-size:2.5rem;font-weight:300;margin:.5rem 0;}
    .subtitle{font-size:1.2rem;font-weight:300;margin-bottom:2rem;}

    .theme-info{background:var(--bege);border-radius:8px;padding:1.5rem;margin-bottom:2.5rem;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.05);}
    .theme-title{font-size:1.1rem;font-weight:500;margin-bottom:1rem;}
    .color-palette{display:flex;justify-content:center;gap:1rem;margin:1rem 0;}
    .color-swatch{width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 4px rgba(0,0,0,.1);}
    .color-swatch span{font-size:.8rem;color:#444;background:rgba(255,255,255,.8);padding:2px 8px;border-radius:10px;}
    .theme-description{font-size:.95rem;max-width:80%;margin:0 auto;color:#555;}

    .card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:2rem;}
    .card{background:var(--branco);border-radius:8px;overflow:hidden;box-shadow:0 4px 8px rgba(0,0,0,.05);transition:.3s;position:relative;}
    .card:hover{transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,.1);}
    .card-img{height:180px;background:var(--verde-claro);display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.5rem;}
    .card-content{padding:1.5rem;position:relative;}
    .card-title{font-size:1.2rem;font-weight:500;margin-bottom:.5rem;transition:text-decoration .3s;}
    .card-title.selected{text-decoration:line-through;color:#aaa;}
    .card-description{font-size:.9rem;color:#888;margin-bottom:1.5rem;}
    .card-footer{display:flex;justify-content:space-between;align-items:center;}
    .btn{display:inline-block;background:var(--cinza);color:#fff;padding:.6rem 1.2rem;border-radius:4px;text-decoration:none;font-size:.9rem;transition:.3s;}
    .btn:hover{background:#555;}
    .checkbox-wrapper{display:flex;align-items:center;gap:.5rem;}
    .custom-checkbox{-webkit-appearance:none;appearance:none;width:20px;height:20px;border:2px solid var(--cinza);border-radius:4px;cursor:pointer;position:relative;transition:.3s;}
    .custom-checkbox:checked{background:var(--verde-claro);border-color:var(--verde-claro);}
    .custom-checkbox:checked::after{content:'✓';color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);}
    .checkbox-label{font-size:.8rem;color:#888;}
    .item-status{position:absolute;top:3.2rem;left:1.5rem;font-size:.9rem;font-weight:500;color:var(--verde-claro);display:none;}
    .item-status.selected{display:block;}

    /* modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:.3s;}
    .modal-overlay.active{opacity:1;visibility:visible;}
    .modal{background:#fff;border-radius:8px;width:90%;max-width:400px;padding:2rem;box-shadow:0 4px 20px rgba(0,0,0,.15);text-align:center;}
    .modal h3{margin:0;color:var(--cinza);font-weight:500;}
    .modal-actions{display:flex;justify-content:center;gap:1rem;margin-top:1.5rem;}
    .modal-btn{padding:.6rem 1.8rem;border-radius:4px;border:none;font-size:.9rem;cursor:pointer;transition:.3s;}
    .confirm-btn{background:var(--verde-claro);color:#fff;}
    .confirm-btn:hover{background:#8fa788;}
    .cancel-btn{background:#eee;color:#666;}
    .cancel-btn:hover{background:#ddd;}

    footer{text-align:center;margin-top:4rem;padding-top:2rem;border-top:1px solid #eee;color:#888;font-size:.9rem;}
  </style>
</head>

<body>
  <div class="container">
    <!-- ---------- cabeçalho ---------- -->
    <header>
      <h1>Chá de Casa Nova – Luiza &amp; Fellipe</h1>
      <p class="subtitle">Marque o item que você gostaria de levar para nossa nova casa</p>

      <div class="theme-info">
        <div class="theme-title">Paleta de cores da nossa casa</div>
        <div class="color-palette">
          <div class="color-swatch" style="background:#e8e0d0;"><span>Creme</span></div>
          <div class="color-swatch" style="background:#d8cdb5;"><span>Bege</span></div>
          <div class="color-swatch" style="background:#c8a887;"><span>Madeira</span></div>
          <div class="color-swatch" style="background:#b6a284;"><span>Bambu</span></div>
        </div>
        <p class="theme-description">
          Nossa casa terá uma decoração em tons neutros, com elementos em madeira e bambu,
          criando um ambiente acolhedor e natural. Presentes nestas cores combinarão
          perfeitamente com nosso estilo!
        </p>
      </div>
    </header>

    <!-- ---------- grid de cards ---------- -->
    <div class="card-grid">
      <!-- CARD TEMPLATE – copie/cole alterando id e textos -->
      <!-- 1 -->
      <div class="card">
        <div class="card-img">Panelas</div>
        <div class="card-content">
          <h3 class="card-title">Conjunto de panelas</h3>
          <p class="card-description">Conjunto de panelas para cozinhar no dia a dia.</p>
          <div class="card-footer">
            <div class="checkbox-wrapper" style="margin-left:auto;">
              <input type="checkbox" class="custom-checkbox" id="item1" />
              <label for="item1" class="checkbox-label">Escolher item</label>
            </div>
          </div>
        </div>
      </div>
      <!-- 2 -->
      <div class="card">
        <div class="card-img">Talheres</div>
        <div class="card-content">
          <h3 class="card-title">Talheres</h3>
          <p class="card-description">Facas, garfos, colheres grandes e pequenas e faca de carne.</p>
          <div class="card-footer">
            <div class="checkbox-wrapper" style="margin-left:auto;">
              <input type="checkbox" class="custom-checkbox" id="item2" />
              <label for="item2" class="checkbox-label">Escolher item</label>
            </div>
          </div>
        </div>
      </div>
      <!-- 3 -->
      <div class="card">
        <div class="card-img">Utensílios</div>
        <div class="card-content">
          <h3 class="card-title">Colheres e espátulas</h3>
          <p class="card-description">Colheres e espátulas para cozinhar.</p>
          <div class="card-footer">
            <div class="checkbox-wrapper" style="margin-left:auto;">
              <input type="checkbox" class="custom-checkbox" id="item3" />
              <label for="item3" class="checkbox-label">Escolher item</label>
            </div>
          </div>
        </div>
      </div>
      <!-- 4 -->
      <div class="card">
        <div class="card-img">Café</div>
        <div class="card-content">
          <h3 class="card-title">Prensa francesa</h3>
          <p class="card-description">Para preparar café de forma artesanal.</p>
          <div class="card-footer">
            <div class="checkbox-wrapper" style="margin-left:auto;">
              <input type="checkbox" class="custom-checkbox" id="item4" />
              <label for="item4" class="checkbox-label">Escolher item</label>
            </div>
          </div>
        </div>
      </div>
      <!-- 5 -->
      <div class="card">
        <div class="card-img">Churrasco</div>
        <div class="card-content">
          <h3 class="card-title">Kit churrasco</h3>
          <p class="card-description">Kit churrasco Tramontina com 3 peças.</p>
          <div class="card-footer">
            <a href="https://www.magazineluiza.com.br/kit-churrasco-tramontina-10239753-3-pecas/p/238299100"
               target="_blank" class="btn">Ver referência</a>
            <div class="checkbox-wrapper">
              <input type="checkbox" class="custom-checkbox" id="item5" />
              <label for="item5" class="checkbox-label">Escolher item</label>
            </div>
          </div>
        </div>
      </div>
      <!-- 6 -->
      <div class="card">
        <div class="card-img">Pratos</div>
        <div class="card-content">
          <h3 class="card-title">Pratos</h3>
          <p class="card-description">Pratos rasos e fundos para as refeições.</p>
          <div class="card-footer">
            <div class="checkbox-wrapper" style="margin-left:auto;">
              <input type="checkbox" class="custom-checkbox" id="item6" />
              <label for="item6" class="checkbox-label">Escolher item</label>
            </div>
          </div>
        </div>
      </div>
      <!-- Outros cards... (mantidos para economizar espaço) -->
    </div>

    <footer><p>Muito obrigado pelo carinho e presença!</p></footer>
  </div>

  <div class="modal-overlay" id="confirmModal">
    <div class="modal">
      <h3>Confirmação</h3>
      <p class="modal-text" id="modalText">Você optou por [item]. Você confirma?</p>
      <div class="modal-actions">
        <button class="modal-btn confirm-btn" id="confirmBtn">Sim</button>
        <button class="modal-btn cancel-btn" id="cancelBtn">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- =============== Firebase + JS =============== -->
  <script type="module">
    /* 1 ▸ imports */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

    /* 2 ▸ config */
    const firebaseConfig = {
      apiKey: "AIzaSyBthvOflM2Vge4Q2Sc-kJTQ81OA0Zw7i7I",
      authDomain: "chacasanova-dbc8d.firebaseapp.com",
      projectId: "chacasanova-dbc8d",
      storageBucket: "chacasanova-dbc8d.appspot.com",
      messagingSenderId: "332754318600",
      appId: "1:332754318600:web:22d8ac2c56fc5e52d668bd",
      measurementId: "G-TLP3P8XE8P"
    };
    
    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /* 3 ▸ funções de apoio */
    function updateItemAppearance(cb, selected) {
      const card = cb.closest(".card");
      const title = card.querySelector(".card-title");
      const status = card.querySelector(".item-status") || document.createElement("div");
      
      if (!card.querySelector(".item-status")) {
        status.classList.add("item-status");
        status.textContent = "Item já escolhido";
        card.querySelector(".card-content").appendChild(status);
      }
      
      const wrap = card.querySelector(".checkbox-wrapper");
      
      if (selected) {
        title.classList.add("selected");
        status.classList.add("selected");
        wrap.style.display = "none";
      } else {
        title.classList.remove("selected");
        status.classList.remove("selected");
        wrap.style.display = "flex";
      }
    }

    // Função para gravar a escolha no Firestore
    async function gravarEscolha(id) {
      try {
        // Verifica se o item já está escolhido
        const docRef = doc(db, "presentes", id);
        const docSnap = await getDoc(docRef);
        
        if (docSnap.exists() && docSnap.data().escolhido === true) {
          alert("Este item já foi escolhido por outra pessoa!");
          return false;
        }
        
        // Se não estiver escolhido, grava a escolha
        await setDoc(docRef, { 
          escolhido: true,
          timestamp: new Date().toISOString() 
        });
        return true;
      } catch (error) {
        console.error("Erro ao gravar escolha:", error);
        alert("Ocorreu um erro ao escolher o item. Tente novamente.");
        return false;
      }
    }

    // Função para escutar mudanças em tempo real
    function escutarItem(id, cb) {
      return onSnapshot(
        doc(db, "presentes", id),
        (snap) => {
          const marcado = snap.exists() && snap.data()?.escolhido === true;
          cb.checked = marcado;
          updateItemAppearance(cb, marcado);
        },
        (error) => {
          console.error(`Erro ao escutar item ${id}:`, error);
        }
      );
    }

    /* 4 ▸ lógica da página */
    document.addEventListener("DOMContentLoaded", () => {
      /* variáveis do modal */
      const modalOverlay = document.getElementById("confirmModal");
      const modalText = document.getElementById("modalText");
      const confirmBtn = document.getElementById("confirmBtn");
      const cancelBtn = document.getElementById("cancelBtn");
      let currentCheckbox = null;

      /* adiciona status labels aos cards */
      document.querySelectorAll(".card").forEach(card => {
        if (!card.querySelector(".item-status")) {
          const st = document.createElement("div");
          st.classList.add("item-status");
          st.textContent = "Item já escolhido";
          card.querySelector(".card-content").appendChild(st);
        }
      });

      /* funções do modal */
      const openModal = (cb, name) => {
        currentCheckbox = cb;
        modalText.textContent = `Você optou por ${name}. Você confirma?`;
        modalOverlay.classList.add("active");
      };
      
      const closeModal = () => {
        modalOverlay.classList.remove("active");
        if (currentCheckbox) currentCheckbox.checked = false;
        currentCheckbox = null;
      };

      confirmBtn.addEventListener("click", async () => {
        if (currentCheckbox) {
          const success = await gravarEscolha(currentCheckbox.id);
          if (success) {
            closeModal();
          }
        }
      });
      
      cancelBtn.addEventListener("click", closeModal);

      /* listeners de cada checkbox */
      document.querySelectorAll(".custom-checkbox").forEach(cb => {
        // Inicializa estado de cada item
        escutarItem(cb.id, cb);
        
        // Adiciona evento de clique
        cb.addEventListener("click", e => {
          e.preventDefault();
          if (cb.checked) return; // já reservado
          const name = cb.closest(".card").querySelector(".card-title").textContent;
          openModal(cb, name);
        });
      });
    });
  </script>
</body>
</html>
